# --- Identity ---
project: culi_16S
sampleset: loris
dataset:   culi

# --- Root ---
out_root: "$OUT_ROOT"   

# --- Layout ---
layout:
  dataset_dir:        "{sampleset}/{dataset}"
  raw_dir:            "{sampleset}/{dataset}/raw"
  pod5_dir:           "{sampleset}/pod5"
  basecall_dir:       "{sampleset}/basecalled"
  demux_dir:          "{sampleset}/demuxed"
  summary_dir:        "{sampleset}/dorado_summaries"
  sample_sheet_dir:   "{sampleset}/samples"
  sample_sheet_name:  "___RUN____sample_sheet.csv"   
  sample_routing:     "{sampleset}/samples/sample_to_dataset.tsv"

# --- Start point ---
pod5_in: ""        # leave empty to use layout.pod5_dir, or set absolute path here
reads_in: ""       # leave empty if starting from pod5

# --- Containers ---
container_cpu:     "/mnt/nrdstor/richlab/shared/containers/nanomb.sif"
container_gpu:     "/mnt/nrdstor/richlab/shared/containers/nanombgpu.sif"
container_nanoasv: "/mnt/nrdstor/richlab/shared/containers/nanoasv.sif"
container_dorado:  "/mnt/nrdstor/richlab/shared/containers/dorado.sif"
container_iqtree2: ""  # if empty, CPU image is used

# --- References ---
itgdb_udb:   "/mnt/nrdstor/richlab/shared/databases/itgdb_16s/taxa_itgdb.udb"
silva_fasta: "/mnt/nrdstor/richlab/shared/databases/silva138/SILVA_138.2_SSURef_NR99_tax_silva.fasta"

# --- NanoASV ---
asv_method: nanoasv
nanoasv_bin: nanoasv
nanoasv_opts:
  subsample_per_barcode: 2000
  mapq: 20

# (Optional doc only; actual binds come from profile apptainer-args)
binds:
  - /work
  - /lustre
  - /mnt/nrdstor
  - /home
  - /models:/models
  - /refdb:/refdb

# --- Dorado & Medaka ---
dorado_model_name: "dna_r10.4.1_e8.2_400bps_sup@v5.2.0"
dorado_models_dir: "/models"
dorado_extra: ""
medaka_model: "dna_r10.4.1_e8.2_400bps_sup@v5.2.0:consensus"
barcode_kit: "SQK-16S114-24"

# --- Trimming / QC ---
trim_emit_fastq: true
trim_minlen: 1000
trim_skip_glob: ["*NTC*", "*unclassified*"]

minlength: 1300
maxlength: 1700
min_qscore: 15

# --- OTUs / mapping / taxonomy ---
otu_id_primary: 0.99
otu_id_legacy:  0.97
map_id: 0.98
strand: both
sintax_cutoff: 0.8
min_unique_size: 1

# --- SPOA guards ---
spoa_max_reads: 500
spoa_min_reads: 3
spoa_extra: ""

# --- Resources (per-rule; partitions differ where needed) ---
resources:
  dorado_basecall: {threads: 8,  mem_mb: 32000, runtime: 180, partition: gpu,   account: richlab, extra: "--gres=gpu:1"}
  dorado_demux:    {threads: 8,  mem_mb: 32000, runtime: 120, partition: gpu,   account: richlab, extra: "--gres=gpu:1"}
  dorado_trim:     {threads: 8,  mem_mb: 32000, runtime: 240, partition: batch, account: richlab, extra: "--gres=gpu:1"}

  fastcat_filter:        {threads: 4,  mem_mb: 8000,  runtime: 60,  partition: batch, account: richlab}
  nanoplot_qc:           {threads: 2,  mem_mb: 4000,  runtime: 30,  partition: batch, account: richlab}

  isonclust3:            {threads: 16, mem_mb: 32000, runtime: 240, partition: batch, account: richlab}
  spoa_consensus:        {threads: 8,  mem_mb: 16000, runtime: 240, partition: batch, account: richlab}

  vsearch_pool_cluster:  {threads: 16, mem_mb: 32000, runtime: 300, partition: batch, account: richlab}
  map_all_reads:         {threads: 16, mem_mb: 16000, runtime: 180, partition: batch, account: richlab}
  racon_round1:          {threads: 16, mem_mb: 16000, runtime: 120, partition: batch, account: richlab}
  map_r1:                {threads: 16, mem_mb: 16000, runtime: 180, partition: batch, account: richlab}
  racon_round2:          {threads: 16, mem_mb: 16000, runtime: 120, partition: batch, account: richlab}
  medaka_polish:         {threads: 16, mem_mb: 16000, runtime: 240, partition: gpu,   account: richlab, extra: "--gres=gpu:1"}
  chimera_taxonomy_tree: {threads: 16, mem_mb: 32000, runtime: 240, partition: batch, account: richlab}
  iqtree2_tree:          {threads: 16, mem_mb: 64000, runtime: 720, partition: batch, account: richlab}
  otu_table_per_sample:  {threads: 16, mem_mb: 16000, runtime: 180, partition: batch, account: richlab}
  asv_nanoasv:           {threads: 16, mem_mb: 32000, runtime: 360, partition: batch, account: richlab}